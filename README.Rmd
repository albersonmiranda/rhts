---
output:
  github_document:
    html_preview: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rhts

<!-- badges: start -->
[![extendr](https://img.shields.io/badge/extendr-^0.8.1-276DC2)](https://extendr.github.io/extendr/extendr_api/)
<!-- badges: end -->

`rhts` provides hierarchical and grouped time series data structures for R, powered by the Rust crates in [`hts-rs`](https://github.com/albersonmiranda/hts-rs).

## Why `rhts`

It aims to fill the gap between literature and software, offering the latest algorithms for hierarchical time series in a user-friendly R package.

## Key concepts

- **Hierarchical series**: strict parent-child nesting (e.g., State $\rightarrow$ City).
- **Grouped series**: cross-cutting dimensions applied across all hierarchy   levels (e.g., Sector).
- **Summation matrix** $S$: maps bottom-level series to every aggregation level via $y_t = Sb_t$.

## Features

- Flexible hierarchy and grouping specifications.
- Aggregation across all levels from bottom-level series.
- Summation matrix.
- Time frequency agnostic: Annual, Quarterly, Monthly, Weekly, and Daily formats.

## Installation

You can install the development version of `rhts` from GitHub. A [Rust toolchain](https://rust-lang.org/) is required to build the package.

```r
# install.packages("remotes")
remotes::install_github("albersonmiranda/rhts")
```

## Getting started

`rhts` exposes two core classes:

- `HtsSpec`: defines hierarchical and grouped columns.
- `Hts`: loads data, builds the hierarchy, and exposes aggregation utilities.

### Example

This is a basic example using a mixed hierarchy (state, city) with a grouped
dimension (sector).

```{r example}
library(rhts)
hts_data <- data.frame(
  state = c(
    rep("Rio de Janeiro", 4), rep("S達o Paulo", 4),
    rep("Rio de Janeiro", 4), rep("S達o Paulo", 4)
  ),
  city = c(
    rep("Rio de Janeiro", 2), rep("Duque de Caxias", 2),
    rep("S達o Paulo", 2), rep("Campinas", 2),
    rep("Rio de Janeiro", 2), rep("Duque de Caxias", 2),
    rep("S達o Paulo", 2), rep("Campinas", 2)
  ),
  sector = c(
    rep("Industry", 8), rep("Agriculture", 8)
  ),
  quarter = c(
    rep("2024 Q1", 16), rep("2024 Q2", 16)
  ),
  gdp = c(
    1000, 500, 150, 120,
    2000, 800, 300, 200,
    1500, 800, 200, 150,
    2200, 900, 400, 300,
    1100, 600, 180, 130,
    2100, 850, 320, 220,
    1600, 850, 220, 160,
    2300, 950, 420, 320
  )
)

spec <- HtsSpec$new(c("state", "city"), "sector")
hts <- Hts$new(hts_data, spec, "quarter", "gdp")

# Summation matrix
hts$summation_matrix()

# Aggregated series across all levels
hts$aggregated_series()
```

### From CSV

```{r}
path <- system.file("extdata", "tourism.csv", package = "rhts")

spec <- HtsSpec$new(c("Region", "State"), "Purpose")
hts <- Hts$from_csv(path, spec, "Quarter", "Trips")

hts$print()
```

## Data requirements

- Bottom-level data must contain all hierarchy and group columns, plus a time   column and a numeric value column.
- Time strings can be Annual ("2024"), Quarterly ("2024 Q1"), Monthly ("2024 M01"), Weekly ("2024 W01"), or Daily ("2024-01-01").

## Related project

The R package is backed by the Rust crates in [`hts-rs`](https://github.com/albersonmiranda/hts-rs).
